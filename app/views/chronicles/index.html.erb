<% content_for :title, "Toutes les chroniques" %>

<div class="container pt-5 mt-4">
  <h1 class="text-center mb-5 fw-bold" style="color: #5e4636;">Toutes les chroniques</h1>

  <% if @chronicles.empty? %>
    <div class="text-center text-muted">
      <p>Aucune chronique disponible pour le moment.</p>
    </div>
  <% else %>
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <% @chronicles.each do |chronicle| %>
        <div class="col">
          <div class="card h-100 shadow-sm">

            <% if chronicle.photo.attached? %>
              <%= link_to chronicle_path(chronicle) do %>
                <%= image_tag chronicle.photo, class: "card-img-top", style: "height: 300px; object-fit: cover;" %>
              <% end %>
            <% end %>

            <div class="card-body d-flex flex-column">
              <p class="text-muted small mb-1">
                <%= chronicle.created_at.strftime("%d %b %Y") %> · par <%= chronicle.user.username %>
              </p>

              <h5 class="fw-bold mb-2" style="font-size: 1.1rem;">
                <%= link_to truncate(chronicle.title, length: 60), chronicle_path(chronicle), class: "text-decoration-none text-dark" %>
              </h5>

              <p class="text-muted small flex-grow-1">
                <%= truncate(strip_tags(chronicle.content), length: 90) %>
              </p>

              <div class="mt-3">
                <%= link_to "Lire la chronique", chronicle_path(chronicle), class: "btn btn-outline-primary btn-sm w-100" %>

                <% if user_signed_in? && current_user == chronicle.user %>
                  <%= button_to "🗑️ Supprimer", chronicle_path(chronicle),
                      method: :delete,
                      data: { confirm: "Supprimer cette chronique ?" },
                      class: "btn btn-sm btn-outline-danger mt-2 w-100" %>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
