<!-- Hero Section -->
<div class="position-relative text-white mb-5">
  <%= image_tag "hero_books.jpeg", class: "img-fluid w-100", style: "height: 450px; object-fit: cover;" %>
  <div class="position-absolute top-50 start-50 translate-middle text-center px-3">
    <h1 class="display-4 fw-bold text-shadow">Chaque livre est une porte vers un autre monde</h1>
    <%= link_to "Commencer √† √©crire", new_chronicle_path, class: "btn btn-primary btn-lg mt-3 shadow" %>
  </div>
</div>

<!-- Derni√®res chroniques -->
<div class="container my-5">
  <h2 class="mb-4 text-center">Derni√®res chroniques</h2>
  <div class="row">
    <% @chronicles.each do |chronicle| %>
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm border-0">
          <% if chronicle.photo.attached? %>
            <%= image_tag chronicle.photo, class: "card-img-top", style: "height: 200px; object-fit: cover;" %>
          <% end %>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><%= truncate(chronicle.title, length: 50) %></h5>
            <p class="card-text"><%= truncate(chronicle.content, length: 100) %></p>
            <p class="text-muted mb-2"><small>Par <%= chronicle.user.username %></small></p>
            <%= link_to "Lire la suite", chronicle_path(chronicle), class: "btn btn-outline-primary mt-auto" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Top 10 des livres √† lire -->
<div class="container my-5">
  <h2 class="mb-4 text-center">Top 10 des livres √† lire</h2>
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-4 justify-content-center">

    <% top_books = [
      { title: "1984", author: "George Orwell", image: "1984.jpg" },
      { title: "Le Petit Prince", author: "Antoine de Saint-Exup√©ry", image: "le_petit_prince.jpg" },
      { title: "To Kill a Mockingbird", author: "Harper Lee", image: "mockingbird.jpg" },
      { title: "L'√âtranger", author: "Albert Camus", image: "etranger.jpg" },
      { title: "Les Mis√©rables", author: "Victor Hugo", image: "les_miserables.jpg" },
      { title: "The Great Gatsby", author: "F. Scott Fitzgerald", image: "gatsby.jpg" },
    ] %>

    <% top_books.each do |book| %>
      <div class="col">
        <div class="card h-100 shadow-sm border-0" style="width: 180px; height: 270px; overflow: hidden;">
          <%= image_tag book[:image], class: "card-img-top", alt: book[:title], style: "height: 200px; object-fit: cover;" %>
          <div class="card-body p-2 text-center" style="background-color: #fff;">
            <h6 class="card-title fw-bold mb-1" style="font-size: 0.9rem;"><%= truncate(book[:title], length: 30) %></h6>
            <p class="card-text text-muted mb-0" style="font-size: 0.75rem;">par <%= book[:author] %></p>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>


<!-- Carte : librairie proche -->
<div class="container my-5">
  <h2 class="mb-4 text-center">Trouver une librairie autour de vous</h2>
  <div id="map" style="height: 400px;" class="border rounded shadow-sm"></div>
</div>

<!-- Leaflet CDN -->
<%= stylesheet_link_tag "https://unpkg.com/leaflet@1.9.4/dist/leaflet.css", crossorigin: "" %>
<%= javascript_include_tag "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js", crossorigin: "", defer: true %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        const map = L.map('map').setView([lat, lng], 14);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        L.marker([lat, lng])
          .addTo(map)
          .bindPopup("Vous √™tes ici üìç")
          .openPopup();
      }, function () {
        alert("Autorisez la g√©olocalisation pour afficher la carte.");
      });
    } else {
      alert("La g√©olocalisation n‚Äôest pas support√©e.");
    }
  });
</script>
