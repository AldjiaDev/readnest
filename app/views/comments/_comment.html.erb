<div class="comment border p-3 rounded mb-3">
  <p class="mb-1 text-muted small">
    <%= comment.user.username %> Â· <%= time_ago_in_words(comment.created_at) %> ago
  </p>

  <p><%= comment.content %></p>

  <div class="d-flex align-items-center gap-3 mt-2">

    <!-- Bouton Like -->
    <% if user_signed_in? %>
      <% if comment.liked_by_users.include?(current_user) %>
        <%= button_to comment_comment_like_path(comment),
            method: :delete,
            class: "btn btn-sm btn-outline-danger rounded-pill px-3",
            data: { turbo_confirm: "Retirer votre like de ce commentaire ?" } do %>
          ğŸ’” Retirer le like
        <% end %>
      <% else %>
        <%= button_to comment_comment_likes_path(comment),
            method: :post,
            class: "btn btn-sm btn-outline-primary rounded-pill px-3" do %>
          ğŸ’– Liker
        <% end %>
      <% end %>
    <% end %>

    <!-- Supprimer (si autorisÃ©) -->
    <% if user_signed_in? && comment.user == current_user %>
      <%= link_to "Supprimer", comment_path(comment),
          method: :delete,
          data: { turbo_confirm: "Es-tu sÃ»r de vouloir supprimer ce commentaireâ€¯?" },
          class: "btn btn-sm btn-outline-danger rounded-pill px-3" %>
    <% end %>

    <!-- Signaler -->
    <% unless comment.reported? %>
      <%= link_to "Signaler", report_comment_path(comment),
          method: :patch,
          class: "btn btn-sm btn-outline-warning rounded-pill px-3",
          data: { turbo_method: :patch, turbo_confirm: "Signaler ce commentaire comme inappropriÃ© ?" } %>
    <% else %>
      <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">Commentaire signalÃ©</span>
    <% end %>
  </div>

  <!-- Debug temporaire -->
  <% if user_signed_in? %>
    <div class="mt-3 bg-light p-2 rounded small text-muted">
      <strong>Debug Info :</strong><br>
      user_signed_in?: âœ…<br>
      current_user.id: <%= current_user.id %><br>
      comment.id: <%= comment.id %><br>
      liked_by_users: <%= comment.liked_by_users.pluck(:id).inspect %><br>
    </div>
  <% end %>
</div>
